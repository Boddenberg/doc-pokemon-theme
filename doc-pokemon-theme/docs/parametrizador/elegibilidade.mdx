---
sidebar_position: 3
title: Elegibilidade (PA)
hide_table_of_contents: true
---

import React, {useRef, useState} from 'react';
import Mermaid from '@theme/Mermaid';

export default function ElegibilidadePA() {
  const wrapRef = useRef(null);
  const dragRef = useRef({drag:false, sx:0, sy:0});
  const [toast, setToast] = useState('');
  const toastTimer = useRef(null);

  const showToast = (msg) => {
    setToast(msg);
    if (toastTimer.current) clearTimeout(toastTimer.current);
    toastTimer.current = setTimeout(()=> setToast(''), 1600);
  };

  /* --------------------------- DIAGRAMA (Mermaid) --------------------------- */
  const mermaidRender = String.raw`%%{init: {"sequence":{"showSequenceNumbers":true,"mirrorActors":false}}}%%
sequenceDiagram
  title Elegibilidade PA

  participant MotorOfertas as Motor Ofertas
  participant ElegibilidadePA as Elegibilidade PA
  participant DisponibilidadePUC as Disponibilidade PUC

  MotorOfertas->>ElegibilidadePA: Executar(idCliente, idConta, parametrosJornada, listaCartoesCliente, dadosRendaCliente)

  Note over ElegibilidadePA: Etapa 1: Regras de triagem

  break Não foi possível carregar a parametrização da jornada, a lista de cartões do cliente ou a renda do cliente? (obrigatórios p/ PA)
    ElegibilidadePA->>MotorOfertas: Retorna não elegível
  end

  Note right of ElegibilidadePA: Verifica se o cliente possui renda suficiente para contratar o produto,<br/>caso contrário será considerado não elegível
  Note right of ElegibilidadePA: Verifica se o cliente já possui o produto,<br/>caso positivo, será considerado não elegível

  Note over ElegibilidadePA: Etapa 2: Consulta da elegibilidade
  ElegibilidadePA->>DisponibilidadePUC: Consultar elegibilidade na PUC (idCliente, idConta)
  DisponibilidadePUC-->>ElegibilidadePA: Retorna {dadosElegibilidadePUC}

  Note over ElegibilidadePA: Etapa 3: Regras pós-elegibilidade
  alt Cliente aprovado no crédito e limite disponível >= limite mínimo do produto?
    Note right of ElegibilidadePA: Ajusta o limite disponível com base no limite máximo do produto<br/>Cliente considerado elegível
  else
    Note right of ElegibilidadePA: Cliente considerado não elegível
  end

  ElegibilidadePA->>MotorOfertas: Retorna {elegibilidadePA}
`;

  // Versão "texto puro" para copiar/colar
  const mermaidPlain = String.raw`sequenceDiagram
  title Elegibilidade PA

  participant MotorOfertas as Motor Ofertas
  participant ElegibilidadePA as Elegibilidade PA
  participant DisponibilidadePUC as Disponibilidade PUC

  MotorOfertas->>ElegibilidadePA: Executar(idCliente, idConta, parametrosJornada,<br> listaCartoesCliente, dadosRendaCliente)

  Note over ElegibilidadePA: Etapa 1: Regras de triagem

  break Não foi possível carregar a parametrização da jornada, a lista de cartões do cliente ou a renda do cliente, que são informações obrigatórias para a elegibilidade do PA?
    ElegibilidadePA->>MotorOfertas: Retorna não elegível
  end

  Note right of ElegibilidadePA: Verifica se o cliente possui renda suficiente para contratar o produto, <br> caso contrário, ele será considerado não elegível
  Note right of ElegibilidadePA: Verifica se o cliente já possui o produto, <br> caso positivo, ele será considerado não elegível

  Note over ElegibilidadePA: Etapa 2: Consulta da elegibilidade

  ElegibilidadePA->>DisponibilidadePUC: Consultar elegibilidade na PUC (idCliente, idConta)
  DisponibilidadePUC-->>ElegibilidadePA: Retorna {dadosElegibilidadePUC}

  Note over ElegibilidadePA: Etapa 3: Regras pós-elegibilidade

  alt Cliente aprovado na análise de crédito e possui limite disponível maior ou igual ao limite mínimo do produto?
    Note right of ElegibilidadePA: Ajusta o limite disponível do cliente com base no limite máximo permitido para o produto
    Note right of ElegibilidadePA: Cliente considerado elegível
  else
    Note right of ElegibilidadePA: Cliente considerado não elegível
  end

  ElegibilidadePA->>MotorOfertas: Retorna {elegibilidadePA}
`;

  /* --------------------------- Drag-to-scroll --------------------------- */
  const onMouseDown = (e) => {
    const el = e.currentTarget;
    dragRef.current = {drag:true, sx: e.pageX + el.scrollLeft, sy: e.pageY + el.scrollTop};
    el.style.cursor = 'grabbing';
  };
  const onMouseUp = (e) => { dragRef.current.drag = false; e.currentTarget.style.cursor = 'grab'; };
  const onMouseLeave = (e) => { dragRef.current.drag = false; e.currentTarget.style.cursor = 'grab'; };
  const onMouseMove = (e) => {
    const el = e.currentTarget;
    const s = dragRef.current;
    if (!s.drag) return;
    el.scrollLeft = s.sx - e.pageX;
    el.scrollTop  = s.sy - e.pageY;
  };

  /* --------------------------- Export helpers --------------------------- */
  const exportSVG = () => {
    const svg = wrapRef.current?.querySelector('svg');
    if (!svg) return;
    const xml = new XMLSerializer().serializeToString(svg);
    const blob = new Blob([xml], {type:'image/svg+xml'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'elegibilidade-pa.svg'; a.click();
    URL.revokeObjectURL(url);
    showToast('SVG exportado ✓');
  };

  const exportPNG = async (scale=1) => {
    const svg = wrapRef.current?.querySelector('svg');
    if (!svg) return;

    const vb = svg.viewBox && svg.viewBox.baseVal ? {w: svg.viewBox.baseVal.width, h: svg.viewBox.baseVal.height} : null;
    const bbox = !vb ? svg.getBBox() : null;
    const w = vb?.w || Math.ceil(bbox?.width || svg.clientWidth || 1200);
    const h = vb?.h || Math.ceil(bbox?.height || svg.clientHeight || 600);

    const canvas = document.createElement('canvas');
    canvas.width = Math.max(1, Math.floor(w * scale));
    canvas.height = Math.max(1, Math.floor(h * scale));

    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    const xml = new XMLSerializer().serializeToString(svg);
    const url = URL.createObjectURL(new Blob([xml], {type:'image/svg+xml'}));
    await new Promise((resolve)=>{
      const img = new Image();
      img.onload = ()=>{ ctx.drawImage(img, 0, 0, canvas.width, canvas.height); URL.revokeObjectURL(url); resolve(); };
      img.src = url;
    });

    const pngUrl = canvas.toDataURL('image/png');
    const a = document.createElement('a');
    a.href = pngUrl;
    a.download = scale === 2 ? 'elegibilidade-pa@2x.png' : 'elegibilidade-pa.png';
    a.click();

    showToast(scale === 2 ? 'PNG HD exportado ✓' : 'PNG exportado ✓');
  };

  return (
    <>
      {/* --------------------------- Estilos locais --------------------------- */}
      <style>{`
        .page-intro {
          display: grid;
          gap: .75rem;
          margin-bottom: 1rem;
        }
        .pill {
          display:inline-flex; align-items:center; gap:.5rem;
          padding:.35rem .6rem; border-radius:999px;
          background: #eef7ff; color:#0d3b66; border:1px solid #cfe6ff;
          font-weight:700; font-size:.85rem;
        }
        .grid-two {
          display:grid;
          grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
          gap: 1rem;
          margin: 1rem 0;
        }
        .card {
          background:#fff;
          border:1px solid #eaeef4;
          border-radius:14px;
          padding:1rem;
          box-shadow: 0 8px 16px rgba(16,24,40,.06);
        }
        .callout {
          background: linear-gradient(145deg,#fff8e1,#fff);
          border:1px solid #ffe082;
          border-radius: 12px;
          padding: .8rem 1rem;
          color:#4e342e;
        }
        .checklist li { margin:.35rem 0; }

        .diagram-card {
          position: relative;
          background: linear-gradient(135deg,#e3f2fd 0%,#e8f5e9 50%,#fff3e0 100%);
          border-radius: 20px;
          padding: 1.25rem;
          box-shadow: 0 8px 24px rgba(0,0,0,.08);
          border: 1px solid rgba(13,71,161,.12);
          margin-bottom: 1rem;
        }
        .diagram-frame {
          background: rgba(255,255,255,.75);
          backdrop-filter: blur(6px);
          border-radius: 16px;
          border: 1px solid #e0e0e0;
          padding: 1rem;
          overflow: auto;
        }
        .diagram-frame svg { max-width: 100%; height: auto; }
        .diagram-actions {
          display: flex;
          flex-wrap: wrap;
          justify-content: flex-end;
          gap: .5rem;
          margin-top: .75rem;
        }
        .btn {
          appearance: none;
          border: 1px solid transparent;
          padding: .6rem .9rem;
          border-radius: .75rem;
          font-weight: 600;
          font-size: .95rem;
          cursor: pointer;
          transition: transform .12s ease, box-shadow .2s ease, filter .2s ease;
          box-shadow: 0 6px 16px rgba(0,0,0,.08);
          outline: none;
        }
        .btn:focus { box-shadow: 0 0 0 3px rgba(124,58,237,.25); }
        .btn:hover { transform: translateY(-1px); filter: brightness(1.02); }
        .btn-primary {
          color: #fff;
          background: linear-gradient(135deg,#7c3aed 0%,#0ea5e9 100%);
          border: 1px solid rgba(255,255,255,.18);
        }
        .btn-outline {
          color: #0d47a1;
          background: rgba(255,255,255,.85);
          border: 1px solid rgba(13,71,161,.2);
        }

        /* Toast discreto, fixo no canto */
        .toast-fixed{
          position: fixed;
          right: 16px;
          bottom: 16px;
          z-index: 60;
          padding: .45rem .7rem;
          border-radius: 999px;
          background: rgba(28,32,48,.78);
          backdrop-filter: blur(8px);
          color: #f8fafc;
          font-weight: 600;
          font-size: .85rem;
          border: 1px solid rgba(255,255,255,.12);
          box-shadow: 0 10px 30px rgba(0,0,0,.18);
          opacity: 0;
          transform: translateY(6px) scale(.98);
          pointer-events: none;
          transition: opacity .18s ease, transform .18s ease;
        }
        .toast-fixed[data-show="1"]{
          opacity: .92;
          transform: translateY(0) scale(1);
        }
      `}</style>

      {/* --------------------------- Contexto de negócio --------------------------- */}
      <section className="page-intro">
        <span className="pill">Visão de negócio • zero-tec</span>
        <h1>Elegibilidade (PA)</h1>
        <p>
          A elegibilidade é a <b>checagem de bom-senso</b> que diz se faz sentido oferecer o produto PA para um cliente,
          no contexto daquela <i>jornada</i> (canal/experiência). Ela previne ofertas irrelevantes e melhora taxa de conversão.
        </p>
      </section>

      {/* --------------------------- O fluxo em 1 minuto --------------------------- */}
      <div className="card">
        <h2>O fluxo em 1 minuto</h2>
        <ol>
          <li><b>Temos o básico?</b> Conferimos se chegaram as informações mínimas da jornada, dos cartões e da renda.</li>
          <li><b>Regras simples de bom-senso:</b> checamos se há renda suficiente e se o cliente <i>já</i> tem esse produto.</li>
          <li><b>Confirmação de crédito:</b> perguntamos à Disponibilidade PUC se há crédito/limite para esse cliente.</li>
          <li><b>Decisão final:</b> se aprovado e com limite suficiente, o cliente é <b>elegível</b>; senão, <b>não elegível</b>.</li>
          <li><b>Ajuste de limite:</b> quando elegível, alinhamos o valor ao teto permitido pelo produto.</li>
        </ol>
      </div>

      {/* --------------------------- Diagrama interativo --------------------------- */}
      <div className="diagram-card">
        <div
          ref={wrapRef}
          className="diagram-frame"
          style={{cursor:'grab'}}
          onMouseDown={onMouseDown}
          onMouseUp={onMouseUp}
          onMouseLeave={onMouseLeave}
          onMouseMove={onMouseMove}
        >
          <Mermaid value={mermaidRender} />
        </div>
        <div className="diagram-actions">
          <button className="btn btn-primary" onClick={exportSVG}>Exportar SVG</button>
          <button className="btn btn-outline" onClick={()=>exportPNG(1)}>PNG</button>
          <button className="btn btn-outline" onClick={()=>exportPNG(2)}>PNG HD</button>
          <button className="btn btn-outline" onClick={async()=>{ await navigator.clipboard.writeText(mermaidPlain); showToast('Mermaid copiado ✓'); }}>Copiar Mermaid</button>
        </div>
      </div>

      {/* --------------------------- O que precisamos e por quê --------------------------- */}
      <div className="grid-two">
        <div className="card">
          <h2>Informações necessárias (e por quê)</h2>
          <ul className="checklist">
            <li><b>Quem é o cliente</b> (id): para localizar histórico e evitar duplicidades.</li>
            <li><b>Qual conta</b> (id): o limite e as regras podem variar por conta/produto.</li>
            <li><b>Parâmetros da jornada:</b> trazem o <i>mínimo</i> e o <i>máximo</i> de limite do produto nessa experiência (ex.: canal parceiro vs. app).</li>
            <li><b>Lista de cartões do cliente:</b> impede oferecer algo que a pessoa já tem.</li>
            <li><b>Renda do cliente:</b> garante capacidade de pagamento e evita ofertas inadequadas.</li>
          </ul>
          <div className="callout"><b>Esses itens não são “campo técnico”.</b> Eles existem para proteger o cliente e o negócio.</div>
        </div>

        <div className="card">
          <h2>Critérios de decisão (resumo)</h2>
          <ul className="checklist">
            <li><b>Faltou algum item essencial?</b> Não elegível.</li>
            <li><b>Cliente já possui o produto?</b> Não elegível.</li>
            <li><b>Renda insuficiente?</b> Não elegível.</li>
            <li><b>PUC não aprovou ou limite menor que o mínimo?</b> Não elegível.</li>
            <li><b>PUC aprovado e limite suficiente?</b> Elegível (ajuste ao teto se passar do máximo).</li>
          </ul>
        </div>
      </div>

      {/* --------------------------- Exemplos narrados --------------------------- */}
      <div className="card">
        <h2>Exemplos rápidos</h2>
        <details open>
          <summary><b>Ana</b> tem renda de 2.500 e não possui PA</summary>
          <p>Jornada exige renda mínima de 1.200. PUC aprova com limite de 2.000 (mínimo é 500, máximo 3.000). Resultado: <b>elegível</b> com limite 2.000.</p>
        </details>
        <details>
          <summary><b>Bruno</b> já possui PA</summary>
          <p>Mesmo aprovado na PUC, a oferta seria redundante. Resultado: <b>não elegível</b> por “produto existente”.</p>
        </details>
        <details>
          <summary><b>Clara</b> tem renda 900</summary>
          <p>A jornada exige 1.200 de renda mínima. Resultado: <b>não elegível</b> por “renda insuficiente”.</p>
        </details>
      </div>

      {/* --------------------------- Dicas de comunicação --------------------------- */}
      <div className="grid-two">
        <div className="card">
          <h2>Como explicar ao cliente</h2>
          <ul className="checklist">
            <li>Se elegível: “Boa notícia! Você pode contratar o PA com limite de até <i>R$X</i>.”</li>
            <li>Se não elegível por renda: “Neste momento precisamos de uma renda um pouco maior para liberar o PA.”</li>
            <li>Se já possui: “Parece que você já tem esse produto. Quer ajustar ou conhecer alternativas?”</li>
            <li>Se limite insuficiente: “Hoje seu limite disponível está abaixo do mínimo para este produto.”</li>
          </ul>
        </div>
        <div className="card">
          <h2>Boas práticas</h2>
          <ul className="checklist">
            <li>Use mensagens <b>claras e empáticas</b> — sem jargões.</li>
            <li>Evite reprocessar quando faltar dados essenciais; peça os dados primeiro.</li>
            <li>Padronize os <i>motivos</i> (renda, produto existente, sem limite) para monitorar indicadores.</li>
            <li>Revise os <b>limites mínimo/máximo</b> por jornada/canal periodicamente.</li>
          </ul>
        </div>
      </div>

      {/* --------------------------- Toast --------------------------- */}
      <div className="toast-fixed" data-show={toast ? '1' : '0'} role="status" aria-live="polite">
        {toast || ''}
      </div>
    </>
  );
}
